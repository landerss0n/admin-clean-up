---
phase: 03-premium-settings-redesign
plan: 02
type: execute
wave: 2
depends_on: [03-01]
files_modified: [includes/class-admin-page.php]
autonomous: true

must_haves:
  truths:
    - "Admin Bar tab renders 5 toggle switches inside a card component (no form-table)"
    - "Dashboard tab renders 7 toggles in a card with setting groups (Widgets + Site Health)"
    - "Menus tab renders 8 menu items each with toggle + role select inside cards"
    - "Footer tab renders 2 toggles + 2 text inputs inside cards (removal + custom text)"
    - "All toggles use hidden input pattern (unchecked submits 0)"
    - "Field names are unchanged from original (backwards compatible save/load)"
  artifacts:
    - path: "includes/class-admin-page.php"
      provides: "Migrated render methods for adminbar, dashboard, menus, footer tabs"
      contains: "render_toggle"
  key_links:
    - from: "includes/class-admin-page.php"
      to: "includes/class-components.php"
      via: "WP_Clean_Up_Components:: static method calls"
      pattern: "WP_Clean_Up_Components::render_"
---

<objective>
Convert Admin Bar, Dashboard, Menus, and Footer tabs from form-table markup to premium card/toggle components. Each tab method replaces its entire body with WP_Clean_Up_Components calls while preserving exact field names for backwards-compatible settings save/load.

Purpose: These 4 tabs cover the simpler toggle-based settings plus the more complex Menus tab (toggle + select) and Footer tab (toggle + text input), proving all component types work together.
Output: Four fully migrated tab render methods using component library.
</objective>

<execution_context>
@/Users/lucas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lucas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-premium-settings-redesign/03-CONTEXT.md
@.planning/phases/02-ui-architecture/02-02-SUMMARY.md
@.planning/phases/02-ui-architecture/02-03-SUMMARY.md

@includes/class-admin-page.php
@includes/class-components.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Admin Bar and Dashboard tabs</name>
  <files>includes/class-admin-page.php</files>
  <action>
**Replace `render_adminbar_tab()` method body** with component calls.

The Admin Bar tab has 5 simple toggles. Use one card with a setting group:

```php
private function render_adminbar_tab( $options ) {
    $adminbar = isset( $options['adminbar'] ) ? $options['adminbar'] : [];

    ob_start();
    WP_Clean_Up_Components::render_setting_group( [
        'settings' => [
            [
                'name'        => WP_Clean_Up::OPTION_KEY . '[adminbar][remove_wp_logo]',
                'checked'     => ! empty( $adminbar['remove_wp_logo'] ),
                'label'       => __( 'WordPress Logo', 'admin-clean-up' ),
                'description' => __( 'Removes the WordPress logo and its submenu from the admin bar.', 'admin-clean-up' ),
            ],
            [
                'name'        => WP_Clean_Up::OPTION_KEY . '[adminbar][remove_site_menu]',
                'checked'     => ! empty( $adminbar['remove_site_menu'] ),
                'label'       => __( 'Site Name Submenu', 'admin-clean-up' ),
                'description' => __( 'Keeps the main link to the site but removes the submenu.', 'admin-clean-up' ),
            ],
            [
                'name'        => WP_Clean_Up::OPTION_KEY . '[adminbar][remove_new_content]',
                'checked'     => ! empty( $adminbar['remove_new_content'] ),
                'label'       => __( 'New Content Button', 'admin-clean-up' ),
                'description' => __( 'Removes the "+New" button from the admin bar.', 'admin-clean-up' ),
            ],
            [
                'name'        => WP_Clean_Up::OPTION_KEY . '[adminbar][remove_search]',
                'checked'     => ! empty( $adminbar['remove_search'] ),
                'label'       => __( 'Search Field', 'admin-clean-up' ),
                'description' => __( 'Removes the search field from the admin bar.', 'admin-clean-up' ),
            ],
            [
                'name'        => WP_Clean_Up::OPTION_KEY . '[adminbar][remove_howdy_frontend]',
                'checked'     => ! empty( $adminbar['remove_howdy_frontend'] ),
                'label'       => __( 'Account Menu on Frontend', 'admin-clean-up' ),
                'description' => __( 'Hides the "Howdy, username" menu from the admin bar on the frontend. Still visible in admin.', 'admin-clean-up' ),
            ],
        ],
    ] );
    $content = ob_get_clean();

    WP_Clean_Up_Components::render_card( [
        'title'       => __( 'Admin Bar Elements', 'admin-clean-up' ),
        'description' => __( 'Select which elements to remove from the admin bar.', 'admin-clean-up' ),
        'content'     => $content,
    ] );
}
```

**Replace `render_dashboard_tab()` method body** with component calls.

The Dashboard tab has 7 toggles. Group them into two logical sections within one card:
- "Dashboard Widgets" group (5 toggles: welcome panel, at a glance, activity, quick draft, wp events)
- "Site Health" group (2 toggles: remove widget, disable completely)

For the "Completely disable Site Health" toggle, use a longer description that covers all the points from the original bulleted list (combine into a single paragraph).

```php
private function render_dashboard_tab( $options ) {
    $dashboard = isset( $options['dashboard'] ) ? $options['dashboard'] : [];

    ob_start();
    WP_Clean_Up_Components::render_setting_group( [
        'title'    => __( 'Widgets', 'admin-clean-up' ),
        'settings' => [
            [
                'name'    => WP_Clean_Up::OPTION_KEY . '[dashboard][remove_welcome_panel]',
                'checked' => ! empty( $dashboard['remove_welcome_panel'] ),
                'label'   => __( 'Welcome Panel', 'admin-clean-up' ),
            ],
            [
                'name'    => WP_Clean_Up::OPTION_KEY . '[dashboard][remove_at_a_glance]',
                'checked' => ! empty( $dashboard['remove_at_a_glance'] ),
                'label'   => __( 'At a Glance', 'admin-clean-up' ),
            ],
            [
                'name'    => WP_Clean_Up::OPTION_KEY . '[dashboard][remove_activity]',
                'checked' => ! empty( $dashboard['remove_activity'] ),
                'label'   => __( 'Activity', 'admin-clean-up' ),
            ],
            [
                'name'    => WP_Clean_Up::OPTION_KEY . '[dashboard][remove_quick_draft]',
                'checked' => ! empty( $dashboard['remove_quick_draft'] ),
                'label'   => __( 'Quick Draft', 'admin-clean-up' ),
            ],
            [
                'name'    => WP_Clean_Up::OPTION_KEY . '[dashboard][remove_wp_events]',
                'checked' => ! empty( $dashboard['remove_wp_events'] ),
                'label'   => __( 'WordPress Events and News', 'admin-clean-up' ),
            ],
        ],
    ] );
    WP_Clean_Up_Components::render_setting_group( [
        'title'    => __( 'Site Health', 'admin-clean-up' ),
        'settings' => [
            [
                'name'    => WP_Clean_Up::OPTION_KEY . '[dashboard][remove_site_health]',
                'checked' => ! empty( $dashboard['remove_site_health'] ),
                'label'   => __( 'Remove Site Health Widget', 'admin-clean-up' ),
                'description' => __( 'Removes the Site Health Status widget from the dashboard.', 'admin-clean-up' ),
            ],
            [
                'name'    => WP_Clean_Up::OPTION_KEY . '[dashboard][disable_site_health]',
                'checked' => ! empty( $dashboard['disable_site_health'] ),
                'label'   => __( 'Disable Site Health Completely', 'admin-clean-up' ),
                'description' => __( 'Removes Site Health from Tools menu, disables all tests, stops scheduled background checks, disables REST API endpoints, and stops email reports.', 'admin-clean-up' ),
            ],
        ],
    ] );
    $content = ob_get_clean();

    WP_Clean_Up_Components::render_card( [
        'title'       => __( 'Dashboard', 'admin-clean-up' ),
        'description' => __( 'Select which dashboard widgets to remove.', 'admin-clean-up' ),
        'content'     => $content,
    ] );
}
```

CRITICAL: All field name attributes must be EXACTLY the same as the originals (e.g., `wp_clean_up_options[adminbar][remove_wp_logo]`). This ensures the sanitize_options() method continues to work without changes.
  </action>
  <verify>
    - `php -l includes/class-admin-page.php` returns no syntax errors
    - grep for "form-table" in render_adminbar_tab and render_dashboard_tab returns NO matches
    - grep for "render_setting_group" returns matches in both methods
    - grep for "render_card" returns matches in both methods
    - All 5 adminbar field names preserved: remove_wp_logo, remove_site_menu, remove_new_content, remove_search, remove_howdy_frontend
    - All 7 dashboard field names preserved: remove_welcome_panel, remove_at_a_glance, remove_activity, remove_quick_draft, remove_wp_events, remove_site_health, disable_site_health
  </verify>
  <done>Admin Bar renders as single card with 5 toggles. Dashboard renders as single card with two setting groups (Widgets: 5 toggles, Site Health: 2 toggles). No form-table markup in either method. All field names backwards compatible.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate Menus and Footer tabs</name>
  <files>includes/class-admin-page.php</files>
  <action>
**Replace `render_menus_tab()` method body** with component calls.

The Menus tab is more complex: each menu item has a toggle + a role select dropdown. Use one card containing the menu items. For each menu item, render a toggle with the select dropdown included.

Since the select component exists now, render each menu item as a custom block that combines toggle + select. Use output buffering to build the content manually since this tab has a unique structure (toggle enables/disables the select).

Keep the existing JavaScript for enabling/disabling the select when the toggle changes. Add a `data-target` attribute on the toggle checkbox and use the same jQuery logic. BUT: the checkbox is now hidden (acu-toggle__input class) so update the jQuery selector to target `.acu-toggle__input` within the menus context.

Implementation approach for Menus tab:
```php
private function render_menus_tab( $options ) {
    $menus = isset( $options['menus'] ) ? $options['menus'] : [];
    $menu_items = [
        'posts'      => __( 'Posts', 'admin-clean-up' ),
        'media'      => __( 'Media', 'admin-clean-up' ),
        'pages'      => __( 'Pages', 'admin-clean-up' ),
        'appearance' => __( 'Appearance', 'admin-clean-up' ),
        'plugins'    => __( 'Plugins', 'admin-clean-up' ),
        'users'      => __( 'Users', 'admin-clean-up' ),
        'tools'      => __( 'Tools', 'admin-clean-up' ),
        'settings'   => __( 'Settings', 'admin-clean-up' ),
    ];
    $role_options = [
        [ 'value' => 'non_admin',  'label' => __( 'All except administrators', 'admin-clean-up' ) ],
        [ 'value' => 'non_editor', 'label' => __( 'All except administrators & editors', 'admin-clean-up' ) ],
        [ 'value' => 'all',        'label' => __( 'All users', 'admin-clean-up' ) ],
    ];

    ob_start();
    foreach ( $menu_items as $key => $label ) {
        $is_hidden = ! empty( $menus[ 'remove_' . $key ] );
        $hide_for  = isset( $menus[ 'remove_' . $key . '_for' ] ) ? $menus[ 'remove_' . $key . '_for' ] : 'non_admin';

        echo '<div class="acu-menu-item">';
        // Render toggle
        WP_Clean_Up_Components::render_toggle( [
            'name'    => WP_Clean_Up::OPTION_KEY . '[menus][remove_' . $key . ']',
            'checked' => $is_hidden,
            'label'   => sprintf( __( 'Hide "%s" menu', 'admin-clean-up' ), $label ),
        ] );
        // Render role select
        WP_Clean_Up_Components::render_select( [
            'name'     => WP_Clean_Up::OPTION_KEY . '[menus][remove_' . $key . '_for]',
            'value'    => $hide_for,
            'options'  => $role_options,
            'disabled' => ! $is_hidden,
            'id'       => 'menu-role-' . $key,
        ] );
        // Warning for Settings menu
        if ( 'settings' === $key ) {
            echo '<p class="acu-text-warning">';
            esc_html_e( 'Warning: If you hide this for all users, you cannot access this plugin\'s settings via the menu.', 'admin-clean-up' );
            echo '</p>';
        }
        echo '</div>';
    }
    $content = ob_get_clean();

    WP_Clean_Up_Components::render_card( [
        'title'       => __( 'Admin Menus', 'admin-clean-up' ),
        'description' => __( 'Select which admin menus to hide and for which user roles.', 'admin-clean-up' ),
        'content'     => $content,
    ] );

    // JavaScript for toggle-select interaction
    ?>
    <script>
    jQuery(document).ready(function($) {
        $('.acu-menu-item .acu-toggle__input').on('change', function() {
            var $select = $(this).closest('.acu-menu-item').find('.acu-select');
            $select.prop('disabled', !this.checked);
        });
    });
    </script>
    <?php
}
```

Add CSS for `.acu-menu-item` in admin.css? NO — this will be handled via the existing `.acu-setting` styles. The `.acu-menu-item` class provides structure for the JS selector. Add minimal inline-block or flex styling for this wrapper:
- Actually, add a few lines of CSS for `.acu-menu-item` that gives it flex layout with the select appearing below or to the right of the toggle. Add this CSS to admin.css as a small addition. Since Task 1 of plan 03-01 already wrote admin.css, we add `.acu-menu-item` styles to it here. Instead of modifying admin.css (which would conflict with plan 03-01 owning that file), add the styles as an inline `<style>` block at the top of the menus tab output. Keep it minimal:
```css
.acu-menu-item {
    padding: 12px 0;
    border-bottom: 1px solid var(--acu-dark-border);
}
.acu-menu-item:last-child { border-bottom: none; }
.acu-menu-item .acu-select { margin-top: 8px; margin-left: 60px; }
.acu-menu-item .acu-text-warning { margin: 8px 0 0 60px; font-size: 12px; }
```

Wait — this plan already lists only class-admin-page.php in files_modified, and admin.css is owned by plan 03-01. So the inline `<style>` approach is correct for the menus-specific layout. Place it before the card render.

**Replace `render_footer_tab()` method body** with component calls.

The Footer tab has: 2 toggles (remove footer text, remove version) + 2 text inputs (custom footer text, custom version text). Group into two cards: "Footer Text" and "Version Number".

```php
private function render_footer_tab( $options ) {
    $footer = isset( $options['footer'] ) ? $options['footer'] : [];

    // Card 1: Footer Text
    ob_start();
    WP_Clean_Up_Components::render_toggle( [
        'name'        => WP_Clean_Up::OPTION_KEY . '[footer][remove_footer_text]',
        'checked'     => ! empty( $footer['remove_footer_text'] ),
        'label'       => __( 'Remove Footer Text', 'admin-clean-up' ),
        'description' => __( 'Removes "Thank you for creating with WordPress" from the admin footer.', 'admin-clean-up' ),
    ] );
    WP_Clean_Up_Components::render_text_input( [
        'name'        => WP_Clean_Up::OPTION_KEY . '[footer][custom_footer_text]',
        'value'       => $footer['custom_footer_text'] ?? '',
        'label'       => __( 'Custom Footer Text', 'admin-clean-up' ),
        'placeholder' => __( 'E.g. Developed by Digiwise', 'admin-clean-up' ),
        'description' => __( 'Leave empty for WordPress default. Ignored if "Remove Footer Text" is enabled.', 'admin-clean-up' ),
    ] );
    $content1 = ob_get_clean();

    WP_Clean_Up_Components::render_card( [
        'title'       => __( 'Footer Text', 'admin-clean-up' ),
        'content'     => $content1,
    ] );

    // Card 2: Version Number
    ob_start();
    WP_Clean_Up_Components::render_toggle( [
        'name'        => WP_Clean_Up::OPTION_KEY . '[footer][remove_version]',
        'checked'     => ! empty( $footer['remove_version'] ),
        'label'       => __( 'Remove Version Number', 'admin-clean-up' ),
        'description' => __( 'Removes the WordPress version number from the admin footer.', 'admin-clean-up' ),
    ] );
    WP_Clean_Up_Components::render_text_input( [
        'name'        => WP_Clean_Up::OPTION_KEY . '[footer][custom_version_text]',
        'value'       => $footer['custom_version_text'] ?? '',
        'label'       => __( 'Custom Version Text', 'admin-clean-up' ),
        'placeholder' => __( 'E.g. Version 2.0', 'admin-clean-up' ),
        'description' => __( 'Leave empty to show WordPress version. Ignored if "Remove Version Number" is enabled.', 'admin-clean-up' ),
    ] );
    $content2 = ob_get_clean();

    WP_Clean_Up_Components::render_card( [
        'title'       => __( 'Version Number', 'admin-clean-up' ),
        'content'     => $content2,
    ] );
}
```

CRITICAL: All field names must match originals exactly. The sanitize_options() method in the same class validates by these exact names.
  </action>
  <verify>
    - `php -l includes/class-admin-page.php` returns no syntax errors
    - grep for "form-table" in render_menus_tab and render_footer_tab returns NO matches
    - grep for "render_toggle" in render_menus_tab and render_footer_tab returns matches
    - grep for "render_select" in render_menus_tab returns matches
    - grep for "render_text_input" in render_footer_tab returns matches
    - All 16 menus field names preserved (remove_posts, remove_posts_for, ... remove_settings, remove_settings_for)
    - All 4 footer field names preserved: remove_footer_text, custom_footer_text, remove_version, custom_version_text
  </verify>
  <done>Menus tab renders as card with toggle+select pairs for each menu item, with JS for interaction. Footer tab renders as two cards (Footer Text + Version Number) with toggle+text input each. No form-table markup. All field names backwards compatible.</done>
</task>

</tasks>

<verification>
After both tasks:
1. `php -l includes/class-admin-page.php` — No parse errors
2. `grep -c "form-table" includes/class-admin-page.php` — Returns 0 (all tabs in this plan migrated)
3. `grep -c "WP_Clean_Up_Components::" includes/class-admin-page.php` — Returns many matches (component calls throughout)
4. All original field names in sanitize_options() are still present in render methods
</verification>

<success_criteria>
- Admin Bar tab: 1 card, 5 toggles via setting group
- Dashboard tab: 1 card, 2 setting groups (5+2 toggles)
- Menus tab: 1 card, 8 toggle+select pairs with JS interaction
- Footer tab: 2 cards, each with toggle+text input
- No form-table markup in any migrated method
- All field names backwards compatible with sanitize_options()
- PHP syntax valid
</success_criteria>

<output>
After completion, create `.planning/phases/03-premium-settings-redesign/03-02-SUMMARY.md`
</output>
