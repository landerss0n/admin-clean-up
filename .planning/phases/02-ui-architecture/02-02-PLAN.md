---
phase: 02-ui-architecture
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - includes/class-components.php
  - admin-clean-up.php
autonomous: true

must_haves:
  truths:
    - "render_card() outputs a div.acu-card with header and body sections from parameters"
    - "render_toggle() outputs hidden input + checkbox + label with BEM toggle classes"
    - "render_setting_group() outputs grouped settings with optional title"
    - "Hidden input appears BEFORE checkbox in rendered HTML (ensures unchecked=0 submission)"
    - "Each component is callable as a single static method with parameter array"
    - "Components use esc_attr/esc_html for all user-provided values"
  artifacts:
    - path: "includes/class-components.php"
      provides: "Reusable UI component render methods"
      exports: ["render_card", "render_toggle", "render_setting_group"]
    - path: "admin-clean-up.php"
      provides: "Component class loading via require_once"
      contains: "class-components.php"
  key_links:
    - from: "includes/class-components.php"
      to: "assets/css/admin.css"
      via: "BEM class names matching CSS selectors"
      pattern: "acu-card|acu-toggle|acu-setting"
    - from: "admin-clean-up.php"
      to: "includes/class-components.php"
      via: "require_once in load_dependencies()"
      pattern: "require_once.*class-components"
---

<objective>
Create the PHP component render class with static methods for card, toggle, and setting group -- each outputting BEM-classed HTML that matches the CSS from Plan 01.

Purpose: Provide a single-method-call API for rendering UI components, eliminating duplicated HTML when tabs are migrated in Phase 3.
Output: New includes/class-components.php file and updated admin-clean-up.php to load it.
</objective>

<execution_context>
@/Users/lucas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lucas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-ui-architecture/02-RESEARCH.md
@.planning/phases/02-ui-architecture/02-01-PLAN.md
@assets/css/admin.css
@admin-clean-up.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WP_Clean_Up_Components class with render methods</name>
  <files>includes/class-components.php</files>
  <action>
Create a new file `includes/class-components.php` with the following structure:

**File header:**
Standard WordPress plugin file header with package tag, prevent direct access check (ABSPATH).

**Class: WP_Clean_Up_Components**
All methods are public static (callable without instantiation).

**Method 1: render_card( $args = [] )**
Parameters (via wp_parse_args with defaults):
- id (string, default '') -- HTML id attribute
- title (string, default '') -- card header title
- description (string, default '') -- subtitle text below title
- content (string, default '') -- pre-rendered HTML for card body (already escaped by caller)
- modifier (string, default '') -- BEM modifier suffix (e.g., 'highlighted' becomes 'acu-card--highlighted')

Output structure:
```html
<div class="acu-card [acu-card--{modifier}]" [id="{id}"]>
  [if title:]
  <div class="acu-card__header">
    <h3 class="acu-card__title">{title}</h3>
    [if description:]<p class="acu-card__description">{description}</p>[endif]
  </div>
  [endif]
  <div class="acu-card__body">
    {content}
  </div>
</div>
```

Escape: esc_attr() for id, class, modifier. esc_html() for title, description. Content is echoed raw (caller responsibility -- document in PHPDoc). Only add id attribute if non-empty. Only add modifier class if non-empty (use sanitize_html_class on modifier value).

**Method 2: render_toggle( $args = [] )**
Parameters:
- name (string, default '') -- form field name attribute
- value (string, default '1') -- checkbox value when checked
- checked (bool, default false) -- initial checked state
- label (string, default '') -- setting label text
- description (string, default '') -- help text below label
- id (string, default '') -- HTML id (auto-generate with sanitize_title of name if empty)
- disabled (bool, default false) -- disabled state

Output structure (CRITICAL: hidden input BEFORE checkbox):
```html
<div class="acu-setting">
  <input type="hidden" name="{name}" value="0">
  <input type="checkbox"
         id="{id}"
         name="{name}"
         value="{value}"
         class="acu-toggle__input"
         {checked}
         {disabled}>
  <label for="{id}" class="acu-toggle">
    <span class="acu-toggle__track"></span>
    <span class="acu-toggle__thumb"></span>
  </label>
  <div class="acu-setting__content">
    <label for="{id}" class="acu-setting__label">{label}</label>
    [if description:]<p class="acu-setting__description">{description}</p>[endif]
  </div>
</div>
```

Escape: esc_attr() for name, value, id. esc_html() for label, description. Use WordPress checked() function for checked attribute. Use WordPress disabled() function for disabled attribute.

ID auto-generation: If id is empty, generate from name using `'toggle-' . sanitize_title( str_replace( ['[', ']'], ['-', ''], $args['name'] ) )`.

**Method 3: render_setting_group( $args = [] )**
Parameters:
- title (string, default '') -- group heading (optional, shows as uppercase label)
- settings (array, default []) -- array of setting definition arrays (each passed to render_toggle)

Output structure:
```html
<div class="acu-setting-group">
  [if title:]<h4 class="acu-setting-group__title">{title}</h4>[endif]
  <div class="acu-setting-group__items">
    [foreach settings as setting: render_toggle($setting)]
  </div>
</div>
```

Escape: esc_html() for title.

**PHPDoc:** Each method must have a PHPDoc block with @param descriptions and @return void notation. Add a class-level PHPDoc explaining this is the component render library for Admin Clean Up premium UI.
  </action>
  <verify>
php -l includes/class-components.php -- syntax check passes.
grep "class WP_Clean_Up_Components" includes/class-components.php -- class exists.
grep "public static function render_card" includes/class-components.php -- method exists.
grep "public static function render_toggle" includes/class-components.php -- method exists.
grep "public static function render_setting_group" includes/class-components.php -- method exists.
grep 'type="hidden"' includes/class-components.php -- hidden input exists.
grep "esc_attr\|esc_html\|sanitize_html_class" includes/class-components.php -- escaping used.
grep -n 'type="hidden"' includes/class-components.php and grep -n 'type="checkbox"' includes/class-components.php -- verify hidden input line number is LOWER than checkbox line number (hidden before checkbox).
  </verify>
  <done>WP_Clean_Up_Components class exists with render_card(), render_toggle(), render_setting_group() methods. Hidden input precedes checkbox. All output properly escaped. Each component callable as single static method with parameter array.</done>
</task>

<task type="auto">
  <name>Task 2: Register component class in plugin loader</name>
  <files>admin-clean-up.php</files>
  <action>
In admin-clean-up.php, add a require_once line for the components class in the load_dependencies() method. Add it BEFORE the class-admin-page.php require (since admin page will use components in Phase 3). The line:

```php
require_once ADMIN_CLEAN_UP_PLUGIN_DIR . 'includes/class-components.php';
```

Place it right before the existing `require_once ADMIN_CLEAN_UP_PLUGIN_DIR . 'includes/class-admin-page.php';` line with a comment: `// UI components for premium settings`.

Do NOT instantiate the class -- it uses static methods only, no constructor needed.
  </action>
  <verify>
php -l admin-clean-up.php -- syntax check passes.
grep "class-components.php" admin-clean-up.php -- require exists.
grep -B1 "class-admin-page" admin-clean-up.php -- components line appears before admin-page.
  </verify>
  <done>Component class loaded before admin page class. Plugin bootstraps correctly with new dependency. No instantiation needed (static methods).</done>
</task>

</tasks>

<verification>
1. php -l on both modified/created files passes without errors
2. WP_Clean_Up_Components::render_card() accepts parameter array and outputs acu-card BEM HTML
3. WP_Clean_Up_Components::render_toggle() outputs hidden input BEFORE checkbox
4. WP_Clean_Up_Components::render_setting_group() iterates settings array and calls render_toggle
5. All user-provided values escaped with esc_attr/esc_html
6. BEM class names match CSS selectors from 02-01 (acu-card, acu-toggle, acu-setting, acu-setting-group)
7. Component class loaded via require_once before class-admin-page.php
8. No JavaScript required for any component functionality
</verification>

<success_criteria>
- Three render methods exist as public static on WP_Clean_Up_Components
- Hidden input pattern correct (hidden before checkbox, same name attribute)
- BEM classes in HTML match CSS from Plan 01
- All output properly escaped (no raw user input)
- Class loaded in plugin bootstrap before admin page
- PHP syntax validates on all files
</success_criteria>

<output>
After completion, create `.planning/phases/02-ui-architecture/02-02-SUMMARY.md`
</output>
