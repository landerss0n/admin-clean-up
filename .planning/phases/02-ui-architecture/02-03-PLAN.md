---
phase: 02-ui-architecture
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [includes/class-admin-page.php]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Comments tab renders a card with header, toggle switch, and description -- all using acu-* BEM classes"
    - "Toggle switch on Comments tab visually reflects checkbox state via CSS :checked (no JS)"
    - "Hidden input before checkbox ensures unchecked state submits '0' for disable_comments"
  artifacts:
    - path: "includes/class-admin-page.php"
      provides: "Comments tab converted from form-table to component calls"
      contains: "WP_Clean_Up_Components::"
  key_links:
    - from: "includes/class-admin-page.php"
      to: "includes/class-components.php"
      via: "WP_Clean_Up_Components::render_card() and render_toggle() method calls"
      pattern: "WP_Clean_Up_Components::render_card\\("
    - from: "includes/class-admin-page.php"
      to: "assets/css/admin.css"
      via: "BEM class names in rendered HTML matching CSS selectors"
      pattern: "acu-card|acu-toggle"
---

<objective>
Convert the Comments tab from form-table markup to use WP_Clean_Up_Components render methods, proving the component library works in actual admin page rendering.

Purpose: Close the only failed truth in Phase 2 verification -- components exist but are never called. This is the minimum viable proof that CSS design system + PHP components produce correct rendered output.
Output: Comments tab renders using render_card() wrapping a render_toggle() call -- no form-table markup.
</objective>

<execution_context>
@/Users/lucas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lucas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@includes/class-components.php
@includes/class-admin-page.php
@assets/css/admin.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert Comments tab to component-based rendering</name>
  <files>includes/class-admin-page.php</files>
  <action>
Replace the render_comments_tab() method body with component calls.

Current implementation uses form-table markup with a manual checkbox. Replace with:

1. Build toggle content using output buffering to capture render_toggle() output:
   - Start output buffer (ob_start)
   - Call WP_Clean_Up_Components::render_toggle() with:
     - name: WP_Clean_Up::OPTION_KEY . '[comments][disable_comments]'
     - checked: ! empty( $comments_options['disable_comments'] )
     - label: __( 'Disable comments completely', 'admin-clean-up' )
     - description: __( 'Removes all comment functionality: closes comments on all posts, hides existing comments, removes Comments and Discussion from admin menus, disables pingbacks, trackbacks, REST API comments, and XML-RPC comment methods.', 'admin-clean-up' )
   - Capture buffer (ob_get_clean) into $content variable

2. Call WP_Clean_Up_Components::render_card() with:
   - title: __( 'Comments', 'admin-clean-up' )
   - description: __( 'Completely disable comments functionality on your website.', 'admin-clean-up' )
   - content: $content (the captured toggle HTML)

Remove the h2 heading, p.description, and entire form-table/tbody/tr/th/td structure. The card component provides the heading and description via its header. The toggle component provides the checkbox with hidden input pattern.

Keep the method signature unchanged: private function render_comments_tab( $options )
Keep the $comments_options variable extraction at the top.

Do NOT include the bulleted list of individual features (the ul.description block). The toggle description provides a concise summary instead. This keeps the card clean and readable.
  </action>
  <verify>
  Grep for 'WP_Clean_Up_Components::' in includes/class-admin-page.php -- must find at least 2 matches (render_card and render_toggle).
  Grep for 'form-table' in the render_comments_tab method -- must find zero matches.
  Grep for 'acu-card\|acu-toggle' would appear in rendered output when method is called.
  PHP syntax check: php -l includes/class-admin-page.php
  </verify>
  <done>
  render_comments_tab() calls WP_Clean_Up_Components::render_card() with nested render_toggle() output. No form-table markup remains in Comments tab. PHP syntax validates. Hidden input pattern is handled by render_toggle() component (no manual hidden input needed).
  </done>
</task>

<task type="checkpoint:human-verify" gate="non-blocking">
  <what-built>Comments tab converted from WordPress form-table to premium card+toggle layout using the component library</what-built>
  <how-to-verify>
    1. Navigate to Settings > Admin Clean Up > Comments tab
    2. Verify: Card container visible with "Comments" title and description subtitle
    3. Verify: Toggle switch (not checkbox) for "Disable comments completely"
    4. Verify: Toggle slides smoothly when clicked (CSS transition, no JS)
    5. Verify: Save settings -- toggle OFF submits correctly (value persists as unchecked on reload)
    6. Try changing WordPress admin color scheme (Users > Profile) -- toggle accent should adapt
  </how-to-verify>
  <resume-signal>Type "approved" or describe visual/functional issues</resume-signal>
</task>

</tasks>

<verification>
1. `grep -n "WP_Clean_Up_Components::" includes/class-admin-page.php` returns lines with render_card and render_toggle calls
2. `php -l includes/class-admin-page.php` returns "No syntax errors detected"
3. The render_comments_tab method no longer contains `<table`, `form-table`, `<th`, or `<tbody` markup
4. The Comments tab field name remains `wp_clean_up_options[comments][disable_comments]` (backwards compatible)
</verification>

<success_criteria>
- WP_Clean_Up_Components:: is called at least once in the admin page code (gap truth #1 satisfied)
- Comments tab renders card container with toggle switch using BEM classes
- Form data submission still works (field names unchanged, hidden input pattern from component)
- No form-table markup in Comments tab output
</success_criteria>

<output>
After completion, create `.planning/phases/02-ui-architecture/02-03-SUMMARY.md`
</output>
